# 3장. 모든 객체의 공통 메서드

- Object에서 final이 아닌 메서드(equals, hashCode, toString) 등은 모두 재정의를 염두에 두고 설계된 것
- 따라서 이런 메서드를 규약에 맞게 재정의 해야 한다.





## Item 10. equals는 일반 규약을 지켜 재정의 하라

- equals는 재정의 하기 쉬워보이지만 위험이 많아 재정의 하지 않는 것이 좋다.



### 재정의 하지 않는 상황

1. 각 인스턴스가 본질적으로 고유하다.
   - 값을 표현하는 게 아니라 동작하는 개체를 표현하는 클래스
     - ex)Thread
2. 인스턴스의 '논리적 동치성'을 검사할 일이 없다.
3. 상위 클래스에서 재정의한 equals가 하위 클래스에도 들어맞는다.
4. 클래스가 private이거나 package-private이고 equals 메서드를 호출할 일이 없다.



#### equals 호출을 막는 방법

```java
@Override
public boolean equals(Object object) {
    throw new AssertionError();
}
```



### 재정의 하는 상황

1. 논리적 동치성을 확인해야 하는 상황



### equals 메서드를 재정의 할 때는 일반 규약을 따라야 한다.

- equals는 동치 관계를 구현하며 다음을 만족한다.
  - 동치관계 : 집합을 서로 같은 원소들로 이루어진 부분집합으로 나누는 연산

- 반사성 : 객체는 자신과 같아야 한다.
- 대칭성 : 두 객체는 서로에 대한 동치 여부에 똑같이 답해야 한다.
- 추이성 : 첫 번째 객체 = 두 번째 객체, 두 번째 객체 = 세 번째 객체 이면 첫 번째 객체 = 세 번째 객체
- 일관성 : 두 객체가 같다면(그리고 수정되지 않는다면) 앞으로 영원히 같아야 한다.
- null 아님 : 모든 객체가 null과 같이 않아야 한다.



### 올바른 equals 메서드를 구현하는 방법

1. == 연산자를 사용해 입력이 자기 자신의 참조인지 확인한다.
2. instanceof 연산자로 입력이 올바른 타입인지 확인한다.
3. 입력을 올바른 타입으로 형변환 한다.
4. 입력 객체와 자기 자신의 대응되는 핵심 필드들이 모두 일치하는지 하나씩 검사한다.



### Google's AutoValue

- equals를 작성하고 테스트 하는 일은 지루할 수 있다.
- 구글인 만든 프레임 워크로 annotation 추가로 메서드를 작성해준다.





## Item 11. equals를 재정의 하려면 hashCode도 재정의하라

- equals를 재정의한 클래스 모두에서 hashCode도 재정의 해야 한다.

- 그렇지 않으면 hashCode 일반 규약을 어겨 문제를 발생시킨다.



### 좋은 hashCode를 작성하는 요령





- Guava : 해시 충돌이 더욱 적은 방법

- 클래스가 불변이고 해시 코드 계산 비용이 크다면, 캐싱하는 방법을 고려해볼 수 있다.

- 성능을 높이겠다고 해시 코드를 계산할 때 핵심 필드를 생략해서는 안된다.
  - 속도를 빨라 지더라도 해시 품질이 나빠진다.

- hashCode가 밚환하는 값의 생성 규칙을 API 사용자에게 자세히 공표하지 말자.
  - 그래야 클라이언트가 이 값에 의지하지 않고, 추후 계산 방식을 바꿀 수 있다.





## Item 12. toString을 항상 재정의하라

- Obejct의 기본 toString 메서드는 우리가 작성한 클래스에 적합한 문자열을 반환하지 않는다.
- 간결하면서 사람이 읽기 쉬운 형태의 유익한 정보를 반환하도록 작성해야 한다.

##### toString 규약 : 모든 하위 클래스에서 이 메서드를 재정의하라



- toString은 그 객체가 가진 주요 정보 모두를 반환하는 게 좋다.
- toString을 구현할 때 반환값의 포맷을 문서화 할지 정해야 한다.
  - 단점으로 포맷을 한번 명시하면, 평생 그 포맷에 얽매이게 된다.



- 정적 유틸리티 클래스는 toString을 제공할 이유가 없다.
- 열거 타입 또한 완벽한 toString을 제공하니 재정의 하지 않아도 된다.
- google의 AutoValue는 toString까지 생성해준다.

